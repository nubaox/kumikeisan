<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ„é †ä½¿ç”¨æ—¥æ™‚è¨ˆç®—ã‚·ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e2e8f0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(30, 41, 59, 0.95);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .tab-container {
            display: flex;
            background: rgba(45, 55, 72, 0.8);
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .tab-button {
            flex: 1;
            padding: 20px;
            background: transparent;
            border: none;
            color: #cbd5e1;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab-button:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        
        .tab-button.active {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            background: rgba(51, 65, 85, 0.7);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #3b82f6;
            transition: all 0.3s ease;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .input-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
            background: rgba(51, 65, 85, 0.9);
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            color: #cbd5e1;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(71, 85, 105, 0.5);
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            background: rgba(30, 41, 59, 0.8);
            color: #e2e8f0;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            background: rgba(30, 41, 59, 1);
        }
        
        .use-now-btn {
            padding: 8px 12px;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            border-radius: 6px;
            color: #3b82f6;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            margin-top: 8px;
            width: 100%;
        }
        
        .use-now-btn:hover {
            background: rgba(59, 130, 246, 0.3);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            accent-color: #3b82f6;
        }
        
        .line-selector {
            background: rgba(45, 55, 72, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .line-selector h3 {
            color: #06b6d4;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3em;
        }
        
        .production-section {
            background: rgba(45, 55, 72, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .production-section h3 {
            color: #10b981;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3em;
        }
        
        .break-section {
            background: rgba(45, 55, 72, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .break-section h3 {
            color: #f59e0b;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3em;
        }
        
        .break-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .break-group {
            background: rgba(51, 65, 85, 0.7);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border-left: 4px solid #f59e0b;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .break-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
            background: rgba(51, 65, 85, 0.9);
            transition: all 0.3s ease;
        }
        
        .calendar-section {
            background: rgba(45, 55, 72, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .calendar-section h3 {
            color: #8b5cf6;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3em;
        }
        
        .line-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .line-tab {
            padding: 10px 20px;
            background: rgba(51, 65, 85, 0.7);
            border: 2px solid rgba(71, 85, 105, 0.5);
            border-radius: 8px;
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .line-tab:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            color: #3b82f6;
        }
        
        .line-tab.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            color: #3b82f6;
        }
        
        .month-container {
            margin-bottom: 40px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .month-header {
            text-align: center;
            color: #8b5cf6;
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .calendar-header {
            background: rgba(59, 130, 246, 0.2);
            padding: 10px;
            text-align: center;
            font-weight: 600;
            border-radius: 8px;
            color: #3b82f6;
            font-size: 0.9em;
        }
        
        .calendar-day {
            background: rgba(51, 65, 85, 0.7);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(71, 85, 105, 0.3);
            min-height: 70px;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .calendar-day.weekend {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .calendar-day.today {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.5);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }
        
        .calendar-day .date {
            font-weight: 600;
            color: #cbd5e1;
            font-size: 0.8em;
        }
        
        .calendar-day input {
            width: 100%;
            padding: 4px;
            border: 1px solid rgba(71, 85, 105, 0.5);
            border-radius: 4px;
            background: rgba(30, 41, 59, 0.8);
            color: #e2e8f0;
            font-size: 0.8em;
            text-align: center;
        }
        
        .calendar-day input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        
        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }
        
        .result-section {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
            border: 1px solid rgba(5, 150, 105, 0.3);
        }
        
        .result-section.show {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .result-time {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .result-date {
            font-size: 1.2em;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .result-details {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .info-card {
            background: rgba(51, 65, 85, 0.7);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            text-align: center;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .info-card h3 {
            color: #3b82f6;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .info-card p {
            font-size: 1.2em;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .bulk-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .bulk-btn {
            padding: 8px 16px;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            border-radius: 6px;
            color: #3b82f6;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .bulk-btn:hover {
            background: rgba(59, 130, 246, 0.3);
        }
        
        .bulk-input {
            width: 80px;
            padding: 8px;
            border: 1px solid #3b82f6;
            border-radius: 6px;
            background: rgba(30, 41, 59, 0.8);
            color: #e2e8f0;
            text-align: center;
        }
        
        .progress-section {
            background: rgba(45, 55, 72, 0.8);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(71, 85, 105, 0.5);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #1e40af);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .progress-text {
            text-align: center;
            font-weight: 600;
            color: #cbd5e1;
        }
        
        .status-info {
            background: rgba(30, 41, 59, 0.8);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #10b981;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .status-info h4 {
            color: #10b981;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .status-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .status-row:last-child {
            border-bottom: none;
        }
        
        .status-label {
            color: #cbd5e1;
            font-weight: 500;
        }
        
        .status-value {
            color: #e2e8f0;
            font-weight: 600;
        }
        
        .current-time {
            background: rgba(16, 185, 129, 0.2);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .current-time-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #10b981;
        }
        
        .line-calendar {
            display: none;
        }
        
        .line-calendar.active {
            display: block;
        }
        
        .save-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .save-status {
            color: #10b981;
            font-size: 0.9em;
            margin-top: 5px;
            text-align: right;
        }
        
        .daily-seq-info {
            margin-top: 20px;
            background: rgba(30, 41, 59, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .daily-seq-info h4 {
            color: #3b82f6;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .daily-seq-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .daily-seq-row:last-child {
            border-bottom: none;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #8b5cf6, #6d28d9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ­ çµ„é †ä½¿ç”¨æ—¥æ™‚è¨ˆç®—ã‚·ãƒ¼ãƒ«</h1>
            <p>è¤‡æ•°ãƒ©ã‚¤ãƒ³å¯¾å¿œ - çµ„é †ã‹ã‚‰éƒ¨å“ä½¿ç”¨æ™‚åˆ»ã‚’è¨ˆç®—</p>
        </div>
        
        <div class="tab-container">
            <button class="tab-button active" data-tab="main">ğŸ¯ ãƒ¡ã‚¤ãƒ³è¨ˆç®—</button>
            <button class="tab-button" data-tab="schedule">ğŸ“… ç”Ÿç”£ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</button>
        </div>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚¿ãƒ– -->
        <div id="main-tab" class="tab-content active">
            <div class="current-time">
                <div>ç¾åœ¨æ™‚åˆ»: <span class="current-time-display" id="currentTimeDisplay">--:--:--</span></div>
            </div>
            
            <div class="line-selector">
                <h3>ğŸš€ ãƒ©ã‚¤ãƒ³é¸æŠ</h3>
                <div class="input-section">
                    <div class="input-group">
                        <label for="selectedLine">è¨ˆç®—å¯¾è±¡ãƒ©ã‚¤ãƒ³</label>
                        <select id="selectedLine">
                            <option value="line1">MB</option>
                            <option value="line2">å°å‹</option>
                            <option value="line3">RX</option>
                            <option value="line4">L7</option>
                            <option value="line5">WL</option>
                            <option value="line6">RX506</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="input-section">
                <div class="input-group">
                    <label for="lineStartTime">ãƒ©ã‚¤ãƒ³é–‹å§‹æ™‚åˆ» (æ¨™æº–)</label>
                    <input type="time" id="lineStartTime" value="08:20">
                </div>
                
                <div class="input-group">
                    <label for="actualStartTime">è¨ˆç®—é–‹å§‹æ™‚åˆ»</label>
                    <input type="time" id="actualStartTime">
                    <button type="button" class="use-now-btn" id="setCurrentTimeBtn">
                        â± ç¾åœ¨æ™‚åˆ»ã‚’è¨­å®š
                    </button>
                </div>
                
                <div class="input-group">
                    <label for="tactTime">ã‚¿ã‚¯ãƒˆã‚¿ã‚¤ãƒ  (ç§’)</label>
                    <input type="number" id="tactTime" value="234" min="1">
                </div>
                
                <div class="input-group">
                    <label for="currentSeq">ç¾åœ¨ã®çµ„é †</label>
                    <input type="number" id="currentSeq" value="40" min="1">
                </div>
                
                <div class="input-group">
                    <label for="targetSeq">çŸ¥ã‚ŠãŸã„çµ„é †</label>
                    <input type="number" id="targetSeq" value="400" min="1">
                </div>
            </div>
            
            <div class="production-section">
                <h3>ğŸ“Š ä»Šæ—¥ã®ç”Ÿç”£è¨ˆç”» (<span id="currentLineName">MB</span>)</h3>
                <div class="input-section">
                    <div class="input-group">
                        <label for="todayPlan">ä»Šæ—¥ã®ç”Ÿç”£è¨ˆç”» (å°)</label>
                        <input type="number" id="todayPlan" value="70" min="1">
                    </div>
                    
                    <div class="input-group">
                        <label for="completedToday">ä»Šæ—¥ã®å®Œäº†æ•° (å°)</label>
                        <input type="number" id="completedToday" value="0" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label for="monthlyPlan">ä»Šæœˆã®ç”Ÿç”£è¨ˆç”» (å°)</label>
                        <input type="number" id="monthlyPlan" value="3000" min="1">
                    </div>
                    
                    <div class="input-group">
                        <label for="workDaysPerMonth">ä»Šæœˆã®ç¨¼åƒæ—¥æ•°</label>
                        <input type="number" id="workDaysPerMonth" value="22" min="1">
                    </div>
                </div>
            </div>
            
            <div class="status-info">
                <h4>ğŸ“ˆ ç”Ÿç”£çŠ¶æ³</h4>
                <div class="status-row">
                    <span class="status-label">ä»Šæ—¥ã®æ®‹ã‚Šå°æ•°</span>
                    <span class="status-value" id="remainingToday">70å°</span>
                </div>
                <div class="status-row">
                    <span class="status-label">ä»Šæ—¥ã®æœ€çµ‚çµ„é †äºˆæ¸¬</span>
                    <span class="status-value" id="finalSeqToday">110</span>
                </div>
                <div class="status-row">
                    <span class="status-label">é”æˆç‡</span>
                    <span class="status-value" id="achievementRate">0%</span>
                </div>
            </div>
            
            <div class="break-section">
                <h3>â° ä¼‘æ†©æ™‚é–“è¨­å®š</h3>
                <div class="break-inputs">
                    <div class="break-group">
                        <div class="input-group">
                            <label for="break1Time">1å›ç›®ä¼‘æ†©é–‹å§‹æ™‚åˆ»</label>
                            <input type="time" id="break1Time" value="10:00">
                        </div>
                        <div class="input-group">
                            <label for="break1Duration">ä¼‘æ†©æ™‚é–“ (åˆ†)</label>
                            <input type="number" id="break1Duration" value="10" min="0">
                        </div>
                    </div>
                    
                    <div class="break-group">
                        <div class="input-group">
                            <label for="break2Time">2å›ç›®ä¼‘æ†©é–‹å§‹æ™‚åˆ»</label>
                            <input type="time" id="break2Time" value="12:00">
                        </div>
                        <div class="input-group">
                            <label for="break2Duration">ä¼‘æ†©æ™‚é–“ (åˆ†)</label>
                            <input type="number" id="break2Duration" value="45" min="0">
                        </div>
                    </div>
                    
                    <div class="break-group">
                        <div class="input-group">
                            <label for="break3Time">3å›ç›®ä¼‘æ†©é–‹å§‹æ™‚åˆ»</label>
                            <input type="time" id="break3Time" value="15:00">
                        </div>
                        <div class="input-group">
                            <label for="break3Duration">ä¼‘æ†©æ™‚é–“ (åˆ†)</label>
                            <input type="number" id="break3Duration" value="10" min="0">
                        </div>
                    </div>
                    
                    <div class="break-group">
                        <div class="input-group">
                            <label for="break4Time">4å›ç›®ä¼‘æ†©é–‹å§‹æ™‚åˆ»</label>
                            <input type="time" id="break4Time" value="17:00">
                        </div>
                        <div class="input-group">
                            <label for="break4Duration">ä¼‘æ†©æ™‚é–“ (åˆ†)</label>
                            <input type="number" id="break4Duration" value="10" min="0">
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="calculate-btn" id="calculateBtn">
                âš¡ æ™‚åˆ»ã‚’è¨ˆç®—ã™ã‚‹
            </button>
            
            <div class="progress-section" id="progressSection" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #cbd5e1;">ğŸ“Š é€²æ—çŠ¶æ³</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0% å®Œäº†</div>
            </div>
            
            <div class="result-section" id="resultSection">
                <div class="result-title">ğŸ¯ è¨ˆç®—çµæœ</div>
                <div class="result-time" id="resultTime">--:--</div>
                <div class="result-date" id="resultDate">----å¹´--æœˆ--æ—¥</div>
                <div class="result-details" id="resultDetails">è©³ç´°æƒ…å ±</div>
                
                <div class="info-grid">
                    <div class="info-card">
                        <h3>ä½¿ç”¨äºˆå®šæ—¥æ™‚</h3>
                        <p id="arrivalTime">----å¹´--æœˆ--æ—¥ --:--</p>
                    </div>
                    <div class="info-card">
                        <h3>å¿…è¦æ™‚é–“</h3>
                        <p id="totalTime">--</p>
                    </div>
                    <div class="info-card">
                        <h3>ä¼‘æ†©æ™‚é–“</h3>
                        <p id="breakTime">--</p>
                    </div>
                </div>
                
                <div class="daily-seq-info" id="dailySeqInfo" style="display: none;">
                    <h4>ğŸ“… å„æ—¥ã®çµ‚ã‚ã‚Šçµ„é †</h4>
                    <div id="dailySeqList"></div>
                </div>
            </div>
            
            <div class="input-section">
                <div class="input-group">
                    <button class="save-btn" id="saveAllDataBtn">
                        ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                    </button>
                    <button class="download-btn" id="downloadDataBtn">
                        â¬‡ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </button>
                    <div class="save-status" id="saveStatus"></div>
                </div>
            </div>
        </div>
        
        <!-- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã‚¿ãƒ– -->
        <div id="schedule-tab" class="tab-content">
            <div class="calendar-section">
                <h3>ğŸ“… æœˆé–“ç”Ÿç”£ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç† (2ãƒ¶æœˆè¡¨ç¤º)</h3>
                
                <div class="line-tabs">
                    <div class="line-tab active" data-line="line1">MB</div>
                    <div class="line-tab" data-line="line2">å°å‹</div>
                    <div class="line-tab" data-line="line3">RX</div>
                    <div class="line-tab" data-line="line4">L7</div>
                    <div class="line-tab" data-line="line5">WL</div>
                    <div class="line-tab" data-line="line6">RX506</div>
                </div>
                
                <div class="bulk-actions">
                    <input type="number" id="bulkValue" class="bulk-input" placeholder="ç”Ÿç”£å°æ•°" min="0">
                    <button class="bulk-btn" id="copyToAllBtn">å…¨æ—¥ã«ã‚³ãƒ”ãƒ¼</button>
                    <button class="bulk-btn" id="copyToWeekdaysBtn">å¹³æ—¥ã«ã‚³ãƒ”ãƒ¼</button>
                    <button class="bulk-btn" id="clearAllBtn">ã™ã¹ã¦ã‚¯ãƒªã‚¢</button>
                </div>
                
                <!-- ãƒ©ã‚¤ãƒ³1ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
                <div id="line1-calendar" class="line-calendar active">
                    <div id="line1-calendar-container"></div>
                </div>
                
                <!-- ãƒ©ã‚¤ãƒ³2ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
                <div id="line2-calendar" class="line-calendar">
                    <div id="line2-calendar-container"></div>
                </div>
                
                <!-- ãƒ©ã‚¤ãƒ³3ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
                <div id="line3-calendar" class="line-calendar">
                    <div id="line3-calendar-container"></div>
                </div>
                
                <!-- ãƒ©ã‚¤ãƒ³4ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
                <div id="line4-calendar" class="line-calendar">
                    <div id="line4-calendar-container"></div>
                </div>
                
                <!-- ãƒ©ã‚¤ãƒ³5ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
                <div id="line5-calendar" class="line-calendar">
                    <div id="line5-calendar-container"></div>
                </div>
                
                <!-- ãƒ©ã‚¤ãƒ³6ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
                <div id="line6-calendar" class="line-calendar">
                    <div id="line6-calendar-container"></div>
                </div>
                
                <div class="input-section">
                    <div class="input-group">
                        <button class="save-btn" id="saveScheduleBtn">
                            ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                        </button>
                        <button class="download-btn" id="downloadScheduleBtn">
                            â¬‡ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                        </button>
                        <div class="save-status" id="scheduleSaveStatus"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        const productionData = {
            version: "1.0",
            lastSaved: null,
            lines: {
                line1: { 
                    name: "MB",
                    settings: {
                        lineStartTime: "08:20",
                        actualStartTime: "",
                        tactTime: 234,
                        currentSeq: 40,
                        targetSeq: 400,
                        todayPlan: 70,
                        completedToday: 0,
                        monthlyPlan: 3000,
                        workDaysPerMonth: 22,
                        breaks: [
                            { time: "10:00", duration: 10 },
                            { time: "12:00", duration: 45 },
                            { time: "15:00", duration: 10 },
                            { time: "17:00", duration: 10 }
                        ]
                    }, 
                    calendar: {},
                    lastUpdated: null
                },
                line2: { 
                    name: "å°å‹",
                    settings: {
                        lineStartTime: "08:20",
                        actualStartTime: "",
                        tactTime: 234,
                        currentSeq: 1,
                        targetSeq: 1,
                        todayPlan: 70,
                        completedToday: 0,
                        monthlyPlan: 3000,
                        workDaysPerMonth: 22,
                        breaks: [
                            { time: "10:00", duration: 10 },
                            { time: "12:00", duration: 45 },
                            { time: "15:00", duration: 10 },
                            { time: "17:00", duration: 10 }
                        ]
                    }, 
                    calendar: {},
                    lastUpdated: null
                },
                line3: { 
                    name: "RX",
                    settings: {
                        lineStartTime: "08:20",
                        actualStartTime: "",
                        tactTime: 234,
                        currentSeq: 1,
                        targetSeq: 1,
                        todayPlan: 70,
                        completedToday: 0,
                        monthlyPlan: 3000,
                        workDaysPerMonth: 22,
                        breaks: [
                            { time: "10:00", duration: 10 },
                            { time: "12:00", duration: 45 },
                            { time: "15:00", duration: 10 },
                            { time: "17:00", duration: 10 }
                        ]
                    }, 
                    calendar: {},
                    lastUpdated: null
                },
                line4: { 
                    name: "L7",
                    settings: {
                        lineStartTime: "08:20",
                        actualStartTime: "",
                        tactTime: 234,
                        currentSeq: 1,
                        targetSeq: 1,
                        todayPlan: 70,
                        completedToday: 0,
                        monthlyPlan: 3000,
                        workDaysPerMonth: 22,
                        breaks: [
                            { time: "10:00", duration: 10 },
                            { time: "12:00", duration: 45 },
                            { time: "15:00", duration: 10 },
                            { time: "17:00", duration: 10 }
                        ]
                    }, 
                    calendar: {},
                    lastUpdated: null
                },
                line5: { 
                    name: "WL",
                    settings: {
                        lineStartTime: "08:20",
                        actualStartTime: "",
                        tactTime: 234,
                        currentSeq: 1,
                        targetSeq: 1,
                        todayPlan: 70,
                        completedToday: 0,
                        monthlyPlan: 3000,
                        workDaysPerMonth: 22,
                        breaks: [
                            { time: "10:00", duration: 10 },
                            { time: "12:00", duration: 45 },
                            { time: "15:00", duration: 10 },
                            { time: "17:00", duration: 10 }
                        ]
                    }, 
                    calendar: {},
                    lastUpdated: null
                },
                line6: { 
                    name: "RX506",
                    settings: {
                        lineStartTime: "08:20",
                        actualStartTime: "",
                        tactTime: 234,
                        currentSeq: 1,
                        targetSeq: 1,
                        todayPlan: 70,
                        completedToday: 0,
                        monthlyPlan: 3000,
                        workDaysPerMonth: 22,
                        breaks: [
                            { time: "10:00", duration: 10 },
                            { time: "12:00", duration: 45 },
                            { time: "15:00", duration: 10 },
                            { time: "17:00", duration: 10 }
                        ]
                    }, 
                    calendar: {},
                    lastUpdated: null
                }
            }
        };

        // å„æ—¥ã®çµ‚ã‚ã‚Šçµ„é †ã‚’è¨˜éŒ²ã™ã‚‹é…åˆ—
        let dailySequences = [];

        // ç¾åœ¨æ™‚åˆ»ã‚’è¡¨ç¤º
        function updateCurrentTime() {
            try {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                document.getElementById('currentTimeDisplay').textContent = `${hours}:${minutes}:${seconds}`;
            } catch (e) {
                console.error("æ™‚åˆ»æ›´æ–°ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸç¾åœ¨æ™‚åˆ»ã‚’å–å¾—
        function getCurrentTimeFormatted() {
            try {
                const now = new Date();
                return `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            } catch (e) {
                console.error("æ™‚åˆ»å–å¾—ã‚¨ãƒ©ãƒ¼:", e);
                return "00:00";
            }
        }

        // ç¾åœ¨æ™‚åˆ»ã‚’è¨­å®š
        function setCurrentTime() {
            try {
                document.getElementById('actualStartTime').value = getCurrentTimeFormatted();
            } catch (e) {
                console.error("ç¾åœ¨æ™‚åˆ»è¨­å®šã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            try {
                // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®activeã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // æŒ‡å®šã—ãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
                document.getElementById(`${tabName}-tab`).classList.add('active');
                
                // å¯¾å¿œã™ã‚‹ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã«activeã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                document.querySelectorAll('.tab-button').forEach(btn => {
                    if (btn.getAttribute('data-tab') === tabName) {
                        btn.classList.add('active');
                    }
                });
                
                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¿ãƒ–ã®å ´åˆã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
                if (tabName === 'schedule') {
                    const activeLine = document.querySelector('.line-tab.active')?.getAttribute('data-line') || 'line1';
                    generateCalendar(activeLine);
                }
            } catch (e) {
                console.error("ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿æ›´æ–°
        function updateLineData() {
            try {
                const selectedLine = document.getElementById('selectedLine').value;
                document.getElementById('currentLineName').textContent = productionData.lines[selectedLine].name;
                loadLineSettings(selectedLine);
            } catch (e) {
                console.error("ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ãƒ©ã‚¤ãƒ³åˆ‡ã‚Šæ›¿ãˆï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¿ãƒ–ï¼‰
        function switchLine(line) {
            try {
                document.querySelectorAll('.line-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.line-calendar').forEach(cal => {
                    cal.classList.remove('active');
                });
                
                const lineTab = document.querySelector(`.line-tab[data-line="${line}"]`);
                const lineCalendar = document.getElementById(`${line}-calendar`);
                
                if (lineTab) lineTab.classList.add('active');
                if (lineCalendar) lineCalendar.classList.add('active');
                
                generateCalendar(line);
            } catch (e) {
                console.error("ãƒ©ã‚¤ãƒ³åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // æ™‚é–“è¨ˆç®—é–¢æ•°ã®ä¿®æ­£ç‰ˆ
function calculateTime() {
    try {
        const line = document.getElementById('selectedLine').value;
        const lineStartTime = document.getElementById('lineStartTime').value;
        let actualStartTime = document.getElementById('actualStartTime').value;
        
        if (!actualStartTime) {
            actualStartTime = lineStartTime;
            document.getElementById('actualStartTime').value = actualStartTime;
        }
        
        const tactTime = parseInt(document.getElementById('tactTime').value) || 234;
        const currentSeq = parseInt(document.getElementById('currentSeq').value) || 1;
        const targetSeq = parseInt(document.getElementById('targetSeq').value) || 1;
        const completedToday = parseInt(document.getElementById('completedToday').value) || 0;
        const todayPlan = parseInt(document.getElementById('todayPlan').value) || 0;
        
        // ä¼‘æ†©æ™‚é–“å–å¾—
        const breaks = [
            { time: document.getElementById('break1Time').value, duration: parseInt(document.getElementById('break1Duration').value) || 0 },
            { time: document.getElementById('break2Time').value, duration: parseInt(document.getElementById('break2Duration').value) || 0 },
            { time: document.getElementById('break3Time').value, duration: parseInt(document.getElementById('break3Duration').value) || 0 },
            { time: document.getElementById('break4Time').value, duration: parseInt(document.getElementById('break4Duration').value) || 0 }
        ].filter(b => b.time && b.duration > 0);

        // åŸºæœ¬è¨ˆç®—
        const seqDiff = targetSeq - currentSeq;
        if (seqDiff <= 0) {
            alert("ç›®æ¨™çµ„é †ã¯ç¾åœ¨çµ„é †ã‚ˆã‚Šå¤§ãã„å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            return;
        }
        
        let remainingSeqs = seqDiff;
        let totalBreakTime = 0;
        dailySequences = []; // å„æ—¥ã®çµ‚ã‚ã‚Šçµ„é †ã‚’ãƒªã‚»ãƒƒãƒˆ
        
        // å®Ÿéš›ã®é–‹å§‹æ™‚åˆ»ã‚’ä½¿ç”¨
        const [startHours, startMinutes] = actualStartTime.split(':').map(Number);
        let currentDate = new Date();
        currentDate.setHours(startHours, startMinutes, 0, 0);
        
        // çµ‚äº†æ—¥æ™‚ã‚’è¨ˆç®—ï¼ˆåˆæœŸå€¤ã¯é–‹å§‹æ™‚åˆ»ï¼‰
        let endDate = new Date(currentDate);
        
        // ç”Ÿç”£è¨ˆç”»ã‚’è€ƒæ…®ã—ãŸæ—¥ä»˜è·¨ãè¨ˆç®—
        while (remainingSeqs > 0) {
            // å½“æ—¥ã®ç”Ÿç”£è¨ˆç”»ã‚’å–å¾—ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ï¼‰
            const dailyPlan = getTodayPlan(currentDate);
            
            // åˆæ—¥ã®ã¿å®Œäº†æ•°ã‚’è€ƒæ…®
            const isToday = currentDate.getDate() === new Date().getDate() && 
                           currentDate.getMonth() === new Date().getMonth() && 
                           currentDate.getFullYear() === new Date().getFullYear();
            
            // å½“æ—¥ç”Ÿç”£å¯èƒ½ãªæ®‹ã‚Šå°æ•° = ç”Ÿç”£è¨ˆç”» - å®Œäº†æ•°
            const remainingToday = isToday ? Math.max(0, dailyPlan - completedToday) : dailyPlan;
            
            // å½“æ—¥ç”Ÿç”£ã™ã‚‹å°æ•°ï¼ˆæ®‹ã‚Šå°æ•°ã¨ç”Ÿç”£å¯èƒ½å°æ•°ã®å°ã•ã„æ–¹ï¼‰
            const produceToday = Math.min(remainingSeqs, remainingToday);
            
            if (produceToday <= 0) {
                // å½“æ—¥ã®ç”Ÿç”£è¨ˆç”»ã‚’é”æˆã—ã¦ã„ã‚‹ã®ã§ç¿Œæ—¥ã¸
                // åœŸæ—¥ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                let nextDate = new Date(currentDate);
                do {
                    nextDate.setDate(nextDate.getDate() + 1);
                } while (nextDate.getDay() === 0 || nextDate.getDay() === 6);
                
                currentDate = nextDate;
                const [startH, startM] = lineStartTime.split(':').map(Number);
                currentDate.setHours(startH, startM, 0, 0);
                continue;
            }
            
            // ç”Ÿç”£æ™‚é–“è¨ˆç®—
            const productionTime = produceToday * tactTime;
            
            // ä½œæ¥­çµ‚äº†æ™‚åˆ»ã‚’è¨ˆç®—ï¼ˆä¼‘æ†©æ™‚é–“ã‚’è€ƒæ…®ï¼‰
            let remainingProductionTime = productionTime;
            let currentPosition = new Date(currentDate);
            
            // ä¼‘æ†©æ™‚é–“ã‚’è€ƒæ…®ã—ãŸä½œæ¥­æ™‚é–“è¨ˆç®—
            while (remainingProductionTime > 0) {
                // å½“æ—¥ã®çµ‚äº†æ™‚åˆ»ï¼ˆ23:59:59ï¼‰
                const dayEnd = new Date(currentPosition);
                dayEnd.setHours(23, 59, 59, 999);
                
                // å½“æ—¥ã®ä¼‘æ†©æ™‚é–“ã‚’å–å¾—
                const dayBreaks = breaks.map(b => {
                    const [hours, minutes] = b.time.split(':').map(Number);
                    const breakTime = new Date(currentPosition);
                    breakTime.setHours(hours, minutes, 0, 0);
                    return {
                        time: breakTime,
                        duration: b.duration * 60 // åˆ†â†’ç§’å¤‰æ›
                    };
                }).filter(b => b.time.getDate() === currentPosition.getDate());
                
                // ä¼‘æ†©æ™‚é–“ã‚’ã‚½ãƒ¼ãƒˆ
                dayBreaks.sort((a, b) => a.time.getTime() - b.time.getTime());
                
                // å½“æ—¥ã®ä½œæ¥­å¯èƒ½æ™‚é–“ã‚’è¨ˆç®—
                let workStart = currentPosition.getTime();
                let workEnd = Math.min(
                    workStart + remainingProductionTime * 1000,
                    dayEnd.getTime()
                );
                
                // ä¼‘æ†©æ™‚é–“ã‚’è€ƒæ…®ã—ã¦å®Ÿéš›ã®ä½œæ¥­æ™‚é–“ã‚’è¨ˆç®—
                let actualWorkTime = 0;
                let lastWorkEnd = workStart;
                
                for (const b of dayBreaks) {
                    const breakStart = b.time.getTime();
                    const breakEnd = breakStart + b.duration * 1000;
                    
                    // ä¼‘æ†©å‰ã®ä½œæ¥­æ™‚é–“
                    if (lastWorkEnd < breakStart) {
                        const segment = Math.min(breakStart, workEnd) - lastWorkEnd;
                        actualWorkTime += segment;
                        lastWorkEnd = breakStart;
                    }
                    
                    // ä¼‘æ†©æ™‚é–“ã‚’ã‚¹ã‚­ãƒƒãƒ—
                    if (lastWorkEnd < breakEnd) {
                        totalBreakTime += (breakEnd - lastWorkEnd) / 1000;
                        lastWorkEnd = breakEnd;
                    }
                    
                    if (lastWorkEnd >= workEnd) break;
                }
                
                // æœ€å¾Œã®ä¼‘æ†©å¾Œã®ä½œæ¥­æ™‚é–“
                if (lastWorkEnd < workEnd) {
                    actualWorkTime += workEnd - lastWorkEnd;
                }
                
                // å®Ÿéš›ã®ä½œæ¥­æ™‚é–“ã‚’åŠ ç®—
                const workedTime = actualWorkTime / 1000;
                remainingProductionTime -= workedTime;
                
                // çµ‚äº†ä½ç½®ã‚’æ›´æ–°
                endDate = new Date(workEnd);
                
                // ç¿Œæ—¥ã«ç§»å‹•
                if (remainingProductionTime > 0) {
                    currentPosition = new Date(dayEnd);
                    currentPosition.setDate(currentPosition.getDate() + 1);
                    const [startH, startM] = lineStartTime.split(':').map(Number);
                    currentPosition.setHours(startH, startM, 0, 0);
                }
            }
            
            // å½“æ—¥ã®çµ‚ã‚ã‚Šçµ„é †ã‚’è¨˜éŒ²
            const endSeq = currentSeq + (seqDiff - remainingSeqs) + (isToday ? completedToday : 0);
            dailySequences.push({
                date: new Date(currentDate),
                endSeq: endSeq
            });
            
            // æ®‹ã‚Šå°æ•°ã‚’æ›´æ–°
            remainingSeqs -= produceToday;
            
            // ç¿Œæ—¥ã«ç§»å‹•
            if (remainingSeqs > 0) {
                // åœŸæ—¥ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                let nextDate = new Date(currentDate);
                do {
                    nextDate.setDate(nextDate.getDate() + 1);
                } while (nextDate.getDay() === 0 || nextDate.getDay() === 6);
                
                currentDate = nextDate;
                const [startH, startM] = lineStartTime.split(':').map(Number);
                currentDate.setHours(startH, startM, 0, 0);
            }
        }
        
        // çµæœè¡¨ç¤º
        const arrivalHours = String(endDate.getHours()).padStart(2, '0');
        const arrivalMinutes = String(endDate.getMinutes()).padStart(2, '0');
        const arrivalTime = `${arrivalHours}:${arrivalMinutes}`;
        
        showResult(arrivalTime, endDate, seqDiff * tactTime, totalBreakTime, seqDiff);
        
        // è¨­å®šã‚’ä¿å­˜
        saveLineSettings(line);
        
    } catch (e) {
        console.error("è¨ˆç®—ã‚¨ãƒ©ãƒ¼:", e);
        alert("è¨ˆç®—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + e.message);
    }
}

        // æŒ‡å®šã—ãŸæ—¥ä»˜ã®ç”Ÿç”£è¨ˆç”»ã‚’å–å¾—
        function getTodayPlan(date) {
            try {
                const line = document.getElementById('selectedLine').value;
                const dateKey = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
                return parseInt(productionData.lines[line].calendar[dateKey]) || 0;
            } catch (e) {
                console.error("ç”Ÿç”£è¨ˆç”»å–å¾—ã‚¨ãƒ©ãƒ¼:", e);
                return 0;
            }
        }

        // çµæœè¡¨ç¤º
        function showResult(arrivalTime, arrivalDate, productionTime, breakTime, seqDiff) {
            try {
                document.getElementById('resultTime').textContent = arrivalTime;
                
                // æ—¥ä»˜ã‚’è¡¨ç¤º
                const year = arrivalDate.getFullYear();
                const month = arrivalDate.getMonth() + 1;
                const day = arrivalDate.getDate();
                document.getElementById('resultDate').textContent = `${year}å¹´${month}æœˆ${day}æ—¥`;
                
                // ä½¿ç”¨äºˆå®šæ—¥æ™‚
                document.getElementById('arrivalTime').textContent = `${year}å¹´${month}æœˆ${day}æ—¥ ${arrivalTime}`;
                document.getElementById('totalTime').textContent = formatDuration(productionTime + breakTime);
                document.getElementById('breakTime').textContent = formatDuration(breakTime);
                
                // å„æ—¥ã®çµ‚ã‚ã‚Šçµ„é †ã‚’è¡¨ç¤º
                const dailySeqList = document.getElementById('dailySeqList');
                dailySeqList.innerHTML = '';
                
                dailySequences.forEach(item => {
                    const dateStr = `${item.date.getFullYear()}å¹´${item.date.getMonth() + 1}æœˆ${item.date.getDate()}æ—¥`;
                    const row = document.createElement('div');
                    row.className = 'daily-seq-row';
                    row.innerHTML = `
                        <span>${dateStr}</span>
                        <span>çµ„é †${item.endSeq}</span>
                    `;
                    dailySeqList.appendChild(row);
                });
                
                document.getElementById('dailySeqInfo').style.display = 'block';
                document.getElementById('resultSection').classList.add('show');
                
                updateProductionStatus();
            } catch (e) {
                console.error("çµæœè¡¨ç¤ºã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ç”Ÿç”£çŠ¶æ³æ›´æ–°
        function updateProductionStatus() {
            try {
                const now = new Date();
                const todayPlan = getTodayPlan(now);
                const completedToday = parseInt(document.getElementById('completedToday').value) || 0;
                const remainingToday = Math.max(0, todayPlan - completedToday);
                
                document.getElementById('todayPlan').value = todayPlan;
                
                let achievementRate = "0%";
                if (todayPlan > 0) {
                    achievementRate = `${((completedToday / todayPlan) * 100).toFixed(1)}%`;
                }
                
                document.getElementById('remainingToday').textContent = `${remainingToday}å°`;
                document.getElementById('achievementRate').textContent = achievementRate;
                
                // æœ€çµ‚çµ„é †äºˆæ¸¬
                const tactTime = parseInt(document.getElementById('tactTime').value);
                const currentSeq = parseInt(document.getElementById('currentSeq').value);
                
                if (tactTime > 0) {
                    // çµ‚æ¥­æ™‚åˆ»ã‚’17:30ã¨ä»®å®š
                    const endWorkTime = new Date();
                    endWorkTime.setHours(17, 30, 0, 0);
                    
                    // æ®‹ã‚Šç¨¼åƒæ™‚é–“ï¼ˆç§’ï¼‰
                    const remainingSeconds = Math.max(0, (endWorkTime - now) / 1000);
                    
                    // ä¼‘æ†©æ™‚é–“ã‚’å·®ã—å¼•ã
                    const remainingWorkTime = remainingSeconds - getRemainingBreakTime(now, endWorkTime);
                    
                    // æœ€çµ‚çµ„é †äºˆæ¸¬
                    const estimatedSeq = currentSeq + Math.floor(remainingWorkTime / tactTime);
                    document.getElementById('finalSeqToday').textContent = estimatedSeq;
                }
            } catch (e) {
                console.error("ç”Ÿç”£çŠ¶æ³æ›´æ–°ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // æ®‹ã‚Šä¼‘æ†©æ™‚é–“ã‚’è¨ˆç®—
        function getRemainingBreakTime(now, endTime) {
            try {
                const breaks = [
                    { time: document.getElementById('break1Time').value, duration: parseInt(document.getElementById('break1Duration').value) || 0 },
                    { time: document.getElementById('break2Time').value, duration: parseInt(document.getElementById('break2Duration').value) || 0 },
                    { time: document.getElementById('break3Time').value, duration: parseInt(document.getElementById('break3Duration').value) || 0 },
                    { time: document.getElementById('break4Time').value, duration: parseInt(document.getElementById('break4Duration').value) || 0 }
                ].filter(b => b.time && b.duration > 0);
                
                let totalBreakTime = 0;
                
                breaks.forEach(breakInfo => {
                    const [hours, minutes] = breakInfo.time.split(':').map(Number);
                    const breakStart = new Date(now);
                    breakStart.setHours(hours, minutes, 0, 0);
                    
                    // ã¾ã ç™ºç”Ÿã—ã¦ã„ãªã„ä¼‘æ†©ã§ã€çµ‚æ¥­æ™‚åˆ»å‰ã®ã‚‚ã®
                    if (breakStart > now && breakStart < endTime) {
                        totalBreakTime += breakInfo.duration * 60; // åˆ†â†’ç§’
                    }
                });
                
                return totalBreakTime;
            } catch (e) {
                console.error("ä¼‘æ†©æ™‚é–“è¨ˆç®—ã‚¨ãƒ©ãƒ¼:", e);
                return 0;
            }
        }

        // ãƒ©ã‚¤ãƒ³è¨­å®šã‚’ä¿å­˜
        function saveLineSettings(line) {
            try {
                productionData.lines[line].settings = {
                    lineStartTime: document.getElementById('lineStartTime').value,
                    actualStartTime: document.getElementById('actualStartTime').value,
                    tactTime: document.getElementById('tactTime').value,
                    currentSeq: document.getElementById('currentSeq').value,
                    targetSeq: document.getElementById('targetSeq').value,
                    todayPlan: document.getElementById('todayPlan').value,
                    completedToday: document.getElementById('completedToday').value,
                    monthlyPlan: document.getElementById('monthlyPlan').value,
                    workDaysPerMonth: document.getElementById('workDaysPerMonth').value,
                    breaks: [
                        {
                            time: document.getElementById('break1Time').value,
                            duration: document.getElementById('break1Duration').value
                        },
                        {
                            time: document.getElementById('break2Time').value,
                            duration: document.getElementById('break2Duration').value
                        },
                        {
                            time: document.getElementById('break3Time').value,
                            duration: document.getElementById('break3Duration').value
                        },
                        {
                            time: document.getElementById('break4Time').value,
                            duration: document.getElementById('break4Duration').value
                        }
                    ],
                    lastUpdated: new Date().toISOString()
                };
                showSaveStatus();
            } catch (e) {
                console.error("è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveCalendarData(line, date, value) {
            try {
                const dateParts = date.split('-');
                const year = parseInt(dateParts[0]);
                const month = parseInt(dateParts[1]) - 1;
                const day = parseInt(dateParts[2]);
                const dateObj = new Date(year, month, day);
                
                // åœŸæ—¥(0=æ—¥æ›œæ—¥, 6=åœŸæ›œæ—¥)ã¯ä¿å­˜ã—ãªã„
                if (dateObj.getDay() !== 0 && dateObj.getDay() !== 6) {
                    productionData.lines[line].calendar[date] = value;
                    productionData.lines[line].lastUpdated = new Date().toISOString();
                    
                    // ä»Šæ—¥ã®æ—¥ä»˜ãªã‚‰ç”Ÿç”£è¨ˆç”»ã‚’æ›´æ–°
                    const today = new Date();
                    if (dateObj.getDate() === today.getDate() && 
                        dateObj.getMonth() === today.getMonth() && 
                        dateObj.getFullYear() === today.getFullYear()) {
                        document.getElementById('todayPlan').value = value || 0;
                        updateProductionStatus();
                    }
                }
            } catch (e) {
                console.error("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¿å­˜ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveAllData() {
            try {
                productionData.lastSaved = new Date().toISOString();
                localStorage.setItem('productionData', JSON.stringify(productionData));
                showSaveStatus();
            } catch (e) {
                console.error("ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadData() {
            try {
                const dataStr = JSON.stringify(productionData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `ç”Ÿç”£ãƒ‡ãƒ¼ã‚¿_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showSaveStatus();
            } catch (e) {
                console.error("ãƒ‡ãƒ¼ã‚¿ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ä¿å­˜çŠ¶æ…‹è¡¨ç¤º
        function showSaveStatus() {
            try {
                const now = new Date();
                const timeStr = now.toLocaleTimeString();
                document.querySelectorAll('.save-status').forEach(el => {
                    el.textContent = `æœ€çµ‚ä¿å­˜: ${timeStr}`;
                    setTimeout(() => {
                        el.textContent = '';
                    }, 3000);
                });
            } catch (e) {
                console.error("ä¿å­˜çŠ¶æ…‹è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ãƒ©ã‚¤ãƒ³è¨­å®šã‚’èª­ã¿è¾¼ã¿
        function loadLineSettings(line) {
            try {
                if (productionData.lines[line]?.settings) {
                    const settings = productionData.lines[line].settings;
                    
                    document.getElementById('lineStartTime').value = settings.lineStartTime || '08:00';
                    document.getElementById('actualStartTime').value = settings.actualStartTime || '';
                    document.getElementById('tactTime').value = settings.tactTime || 180;
                    document.getElementById('currentSeq').value = settings.currentSeq || 1;
                    document.getElementById('targetSeq').value = settings.targetSeq || 1;
                    
                    // ä»Šæ—¥ã®ç”Ÿç”£è¨ˆç”»ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰è‡ªå‹•å–å¾—
                    const today = new Date();
                    const todayPlan = getTodayPlan(today);
                    document.getElementById('todayPlan').value = todayPlan || (settings.todayPlan || 150);
                    
                    document.getElementById('completedToday').value = settings.completedToday || 0;
                    document.getElementById('monthlyPlan').value = settings.monthlyPlan || 3000;
                    document.getElementById('workDaysPerMonth').value = settings.workDaysPerMonth || 22;
                    
                    if (settings.breaks && settings.breaks.length >= 4) {
                        document.getElementById('break1Time').value = settings.breaks[0].time || '10:00';
                        document.getElementById('break1Duration').value = settings.breaks[0].duration || 10;
                        document.getElementById('break2Time').value = settings.breaks[1].time || '12:00';
                        document.getElementById('break2Duration').value = settings.breaks[1].duration || 45;
                        document.getElementById('break3Time').value = settings.breaks[2].time || '15:00';
                        document.getElementById('break3Duration').value = settings.breaks[2].duration || 10;
                        document.getElementById('break4Time').value = settings.breaks[3].time || '17:00';
                        document.getElementById('break4Duration').value = settings.breaks[3].duration || 10;
                    }
                }
            } catch (e) {
                console.error("è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ
        function generateCalendar(line) {
            try {
                const container = document.getElementById(`${line}-calendar-container`);
                if (!container) return;
                
                container.innerHTML = '';
                
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();
                
                // ä»Šæœˆã¨æ¥æœˆã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
                for (let i = 0; i < 2; i++) {
                    const month = (currentMonth + i) % 12;
                    const year = currentYear + Math.floor((currentMonth + i) / 12);
                    
                    const monthContainer = document.createElement('div');
                    monthContainer.className = 'month-container';
                    
                    const monthHeader = document.createElement('div');
                    monthHeader.className = 'month-header';
                    monthHeader.textContent = `${year}å¹´ ${month + 1}æœˆ`;
                    monthContainer.appendChild(monthHeader);
                    
                    const calendarGrid = document.createElement('div');
                    calendarGrid.className = 'calendar-grid';
                    
                    // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼
                    const weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
                    weekdays.forEach(day => {
                        const dayHeader = document.createElement('div');
                        dayHeader.className = 'calendar-header';
                        dayHeader.textContent = day;
                        calendarGrid.appendChild(dayHeader);
                    });
                    
                    // æœˆã®æœ€åˆã®æ—¥
                    const firstDay = new Date(year, month, 1);
                    // æœˆã®æœ€å¾Œã®æ—¥
                    const lastDay = new Date(year, month + 1, 0);
                    
                    // æœ€åˆã®æ—¥ã®æ›œæ—¥ (0=æ—¥æ›œæ—¥)
                    const firstDayOfWeek = firstDay.getDay();
                    
                    // å‰æœˆã®æœ€å¾Œã®æ—¥
                    const prevLastDay = new Date(year, month, 0).getDate();
                    
                    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã‚’ç”Ÿæˆ
                    let dayCount = 1;
                    let nextMonthDay = 1;
                    
                    // 6é€±é–“åˆ†ã®è¡Œã‚’ç”Ÿæˆ
                    for (let i = 0; i < 6; i++) {
                        // é€±ã®æ—¥ä»˜ã‚’ç”Ÿæˆ
                        for (let j = 0; j < 7; j++) {
                            const dayElement = document.createElement('div');
                            dayElement.className = 'calendar-day';
                            
                            // å‰æœˆã®æ—¥ä»˜
                            if (i === 0 && j < firstDayOfWeek) {
                                const prevDay = prevLastDay - (firstDayOfWeek - j - 1);
                                dayElement.innerHTML = `<div class="date" style="opacity:0.5">${prevDay}</div>`;
                                dayElement.style.opacity = '0.5';
                            }
                            // å½“æœˆã®æ—¥ä»˜
                            else if (dayCount <= lastDay.getDate()) {
                                const dateKey = `${year}-${month + 1}-${dayCount}`;
                                const savedValue = productionData.lines[line].calendar[dateKey] || '';
                                
                                // åœŸæ—¥ã®å ´åˆã€å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¡¨ç¤ºã—ãªã„
                                if (j === 0 || j === 6) {
                                    dayElement.innerHTML = `<div class="date">${dayCount}</div>`;
                                    dayElement.classList.add('weekend');
                                } else {
                                    dayElement.innerHTML = `
                                        <div class="date">${dayCount}</div>
                                        <input type="number" 
                                               placeholder="0" 
                                               value="${savedValue}"
                                               onchange="saveCalendarData('${line}', '${dateKey}', this.value)">
                                    `;
                                }
                                
                                // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                                if (dayCount === now.getDate() && month === currentMonth && year === currentYear) {
                                    dayElement.classList.add('today');
                                }
                                
                                dayCount++;
                            }
                            // ç¿Œæœˆã®æ—¥ä»˜
                            else {
                                dayElement.innerHTML = `<div class="date" style="opacity:0.5">${nextMonthDay}</div>`;
                                dayElement.style.opacity = '0.5';
                                nextMonthDay++;
                            }
                            
                            calendarGrid.appendChild(dayElement);
                        }
                    }
                    
                    monthContainer.appendChild(calendarGrid);
                    container.appendChild(monthContainer);
                }
            } catch (e) {
                console.error("ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // ä¸€æ‹¬æ“ä½œ
        function copyToAll() {
            try {
                const value = document.getElementById('bulkValue').value;
                if (!value) return;
                
                const activeLine = document.querySelector('.line-tab.active')?.getAttribute('data-line');
                if (!activeLine) return;
                
                const inputs = document.querySelectorAll(`#${activeLine}-calendar-container .calendar-day input`);
                
                inputs.forEach(input => {
                    input.value = value;
                    const dateElement = input.parentElement.querySelector('.date');
                    if (dateElement && !isNaN(dateElement.textContent)) {
                        const now = new Date();
                        const year = now.getFullYear();
                        const month = now.getMonth() + 1;
                        saveCalendarData(activeLine, `${year}-${month}-${dateElement.textContent}`, value);
                    }
                });
            } catch (e) {
                console.error("ä¸€æ‹¬ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        function copyToWeekdays() {
            try {
                const value = document.getElementById('bulkValue').value;
                if (!value) return;
                
                const activeLine = document.querySelector('.line-tab.active')?.getAttribute('data-line');
                if (!activeLine) return;
                
                const inputs = document.querySelectorAll(`#${activeLine}-calendar-container .calendar-day:not(.weekend) input`);
                
                inputs.forEach(input => {
                    input.value = value;
                    const dateElement = input.parentElement.querySelector('.date');
                    if (dateElement && !isNaN(dateElement.textContent)) {
                        const now = new Date();
                        const year = now.getFullYear();
                        const month = now.getMonth() + 1;
                        saveCalendarData(activeLine, `${year}-${month}-${dateElement.textContent}`, value);
                    }
                });
            } catch (e) {
                console.error("å¹³æ—¥ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        function clearAll() {
            try {
                const activeLine = document.querySelector('.line-tab.active')?.getAttribute('data-line');
                if (!activeLine) return;
                
                const inputs = document.querySelectorAll(`#${activeLine}-calendar-container .calendar-day input`);
                
                inputs.forEach(input => {
                    input.value = '';
                    const dateElement = input.parentElement.querySelector('.date');
                    if (dateElement && !isNaN(dateElement.textContent)) {
                        const now = new Date();
                        const year = now.getFullYear();
                        const month = now.getMonth() + 1;
                        saveCalendarData(activeLine, `${year}-${month}-${dateElement.textContent}`, '');
                    }
                });
            } catch (e) {
                console.error("ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼:", e);
            }
        }

        // æ™‚é–“è¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        function timeToSeconds(time) {
            try {
                const [hours, minutes] = time.split(':').map(Number);
                return hours * 3600 + minutes * 60;
            } catch (e) {
                console.error("æ™‚é–“å¤‰æ›ã‚¨ãƒ©ãƒ¼:", e);
                return 0;
            }
        }

        function formatDuration(seconds) {
            try {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                return `${hours}æ™‚é–“${minutes}åˆ†`;
            } catch (e) {
                console.error("æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼:", e);
                return "0æ™‚é–“0åˆ†";
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // ç¾åœ¨æ™‚åˆ»ã®è¡¨ç¤ºã‚’å³æ™‚æ›´æ–°
                updateCurrentTime();
                // 1ç§’ã”ã¨ã«æ™‚åˆ»ã‚’æ›´æ–°
                setInterval(updateCurrentTime, 1000);
                
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                const savedData = localStorage.getItem('productionData');
                if (savedData) {
                    try {
                        const parsedData = JSON.parse(savedData);
                        Object.assign(productionData, parsedData);
                    } catch (e) {
                        console.error("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:", e);
                    }
                }
                
                // åˆæœŸãƒ©ã‚¤ãƒ³è¨­å®šã‚’èª­ã¿è¾¼ã¿
                const initialLine = document.getElementById('selectedLine').value;
                loadLineSettings(initialLine);
                
                // åˆæœŸã‚¿ãƒ–ã‚’è¨­å®š
                switchTab('main');
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
                document.getElementById('selectedLine').addEventListener('change', updateLineData);
                document.getElementById('setCurrentTimeBtn').addEventListener('click', setCurrentTime);
                document.getElementById('calculateBtn').addEventListener('click', calculateTime);
                document.getElementById('saveAllDataBtn').addEventListener('click', saveAllData);
                document.getElementById('saveScheduleBtn').addEventListener('click', saveAllData);
                document.getElementById('downloadDataBtn').addEventListener('click', downloadData);
                document.getElementById('downloadScheduleBtn').addEventListener('click', downloadData);
                document.getElementById('copyToAllBtn').addEventListener('click', copyToAll);
                document.getElementById('copyToWeekdaysBtn').addEventListener('click', copyToWeekdays);
                document.getElementById('clearAllBtn').addEventListener('click', clearAll);
                
                // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const tabName = this.getAttribute('data-tab');
                        switchTab(tabName);
                    });
                });
                
                // ãƒ©ã‚¤ãƒ³ã‚¿ãƒ–ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
                document.querySelectorAll('.line-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        const line = this.getAttribute('data-line');
                        switchLine(line);
                    });
                });
                
                // è¨­å®šå¤‰æ›´æ™‚ã«è‡ªå‹•ä¿å­˜
                document.getElementById('tactTime').addEventListener('change', function() {
                    const line = document.getElementById('selectedLine').value;
                    saveLineSettings(line);
                });
                
                console.log("åˆæœŸåŒ–å®Œäº†");
            } catch (e) {
                console.error("åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", e);
            }
        });
    </script>
</body>
</html>
